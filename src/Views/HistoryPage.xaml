<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Chronos.App.Views.HistoryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:services="using:Chronos.App.Services"
    mc:Ignorable="d">

    <ScrollViewer Padding="24,20,24,20" HorizontalScrollBarVisibility="Disabled">
        <StackPanel Spacing="24">

            <!-- Header row with title and actions -->
            <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,12,0,0">
                <TextBlock Text="OPERATION HISTORY"
                           FontWeight="SemiBold" FontSize="12" Opacity="0.5"
                           CharacterSpacing="80" VerticalAlignment="Center" />

                <Button Command="{x:Bind ViewModel.RefreshHistoryCommand}"
                        ToolTipService.ToolTip="Refresh"
                        Padding="6" MinWidth="0" MinHeight="0">
                    <FontIcon Glyph="&#xE72C;" FontSize="14" />
                </Button>
                <Button Command="{x:Bind ViewModel.ClearHistoryCommand}"
                        ToolTipService.ToolTip="Clear history"
                        Padding="6" MinWidth="0" MinHeight="0">
                    <FontIcon Glyph="&#xE74D;" FontSize="14" />
                </Button>
            </StackPanel>

            <!-- Empty state -->
            <StackPanel Visibility="{x:Bind ViewModel.ShowEmptyState, Mode=OneWay}"
                        HorizontalAlignment="Center" Spacing="8" Padding="0,48,0,0">
                <FontIcon Glyph="&#xE81C;" FontSize="48" Opacity="0.3"
                          HorizontalAlignment="Center" />
                <TextBlock Text="No operations recorded yet"
                           Opacity="0.5" HorizontalAlignment="Center" />
            </StackPanel>

            <!-- History entries -->
            <ItemsRepeater ItemsSource="{x:Bind ViewModel.HistoryEntries, Mode=OneWay}"
                           Visibility="{x:Bind ViewModel.ShowHistory, Mode=OneWay}">
                <ItemsRepeater.Layout>
                    <StackLayout Spacing="8" />
                </ItemsRepeater.Layout>
                <ItemsRepeater.ItemTemplate>
                    <DataTemplate x:DataType="services:OperationHistoryEntry">
                        <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                              BorderThickness="1" CornerRadius="8" Padding="16,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- Status icon -->
                            <FontIcon Grid.RowSpan="2" VerticalAlignment="Center"
                                      Margin="0,0,14,0" FontSize="20"
                                      Glyph="{x:Bind StatusGlyph}"
                                      Foreground="{x:Bind StatusBrush}" />

                            <!-- Operation type and timestamp -->
                            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{x:Bind OperationType}" FontWeight="SemiBold" />
                                <TextBlock Text="Â·" Opacity="0.4" />
                                <TextBlock Text="{x:Bind FormattedTimestamp}" Opacity="0.6" />
                            </StackPanel>

                            <!-- Duration -->
                            <TextBlock Grid.Column="2" Text="{x:Bind FormattedDuration}"
                                       Opacity="0.6" VerticalAlignment="Center" />

                            <!-- Source/destination paths -->
                            <StackPanel Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2"
                                        Margin="0,4,0,0">
                                <TextBlock Text="{x:Bind SourcePath}" FontSize="12"
                                           Opacity="0.5" IsTextSelectionEnabled="True"
                                           TextTrimming="CharacterEllipsis" />
                                <TextBlock Text="{x:Bind DestinationPath}" FontSize="12"
                                           Opacity="0.5" IsTextSelectionEnabled="True"
                                           TextTrimming="CharacterEllipsis"
                                           Visibility="{x:Bind HasDestination}" />
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>

            <Grid Height="24" />
        </StackPanel>
    </ScrollViewer>
</Page>
