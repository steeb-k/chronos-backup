<?xml version="1.0" encoding="UTF-8" ?>
<Page
    x:Class="Chronos.App.Views.VerifyPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:Chronos.App.Converters"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </Page.Resources>

    <ScrollViewer Padding="24,20,24,20"
                   HorizontalScrollBarVisibility="Disabled"
                   HorizontalAlignment="Stretch">
        <StackPanel Spacing="24" HorizontalAlignment="Stretch">

            <!-- Header -->
            <StackPanel Spacing="8">
                <TextBlock Text="Verify Image" Style="{StaticResource TitleTextBlockStyle}" />
                <TextBlock Text="Verify the integrity of disk images and compute cryptographic hashes."
                           Style="{StaticResource BodyTextBlockStyle}" Opacity="0.7" />
            </StackPanel>

            <!-- Image File -->
            <StackPanel Spacing="12" HorizontalAlignment="Stretch">
                <TextBlock Text="IMAGE FILE" FontWeight="SemiBold" FontSize="12" Opacity="0.5"
                           CharacterSpacing="80" />

                <StackPanel Spacing="12" HorizontalAlignment="Stretch"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1" CornerRadius="8" Padding="20">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBox Header="Image file path" PlaceholderText="Select a .vhdx image..."
                                 Text="{Binding ImagePath, Mode=TwoWay}" />
                        <Button Grid.Column="1" Content="Browse..." VerticalAlignment="Bottom" Margin="8,0,0,0"
                                Click="OnBrowseImageClick" />
                    </Grid>
                </StackPanel>
            </StackPanel>

            <!-- Verification -->
            <StackPanel Spacing="12" HorizontalAlignment="Stretch">
                <TextBlock Text="VERIFICATION" FontWeight="SemiBold" FontSize="12" Opacity="0.5"
                           CharacterSpacing="80" />

                <StackPanel Spacing="0" HorizontalAlignment="Stretch"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1" CornerRadius="8" Padding="20">

                    <!-- Verify integrity -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Integrity Check" FontWeight="SemiBold" />
                        <TextBlock Text="Verify that the image data is not corrupted and matches the stored hash."
                                   Opacity="0.6" FontSize="13" TextWrapping="Wrap" />
                        <ProgressBar Minimum="0" Maximum="100" Value="{Binding ProgressPercentage}"
                                     Visibility="{Binding IsVerifyProgressVisible, Converter={StaticResource BoolToVisibilityConverter}}" />
                        <Grid>
                            <Button Content="Verify Integrity" Padding="20,8"
                                IsEnabled="{Binding CanVerify}"
                                Command="{Binding StartVerificationCommand}" />
                            <StackPanel Orientation="Horizontal"
                                        HorizontalAlignment="Right" Spacing="8" VerticalAlignment="Center"
                                        Visibility="{Binding IsVerifyResultVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                                <FontIcon Glyph="&#xE73E;" Foreground="{StaticResource ChronosSuccessBrush}" FontSize="16" />
                                <TextBlock Text="{Binding StatusMessage}" FontWeight="SemiBold" VerticalAlignment="Center" />
                            </StackPanel>
                        </Grid>
                    </StackPanel>

                    <MenuFlyoutSeparator />

                    <!-- Compute hash -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Compute Hash" FontWeight="SemiBold" />
                        <TextBlock Text="Calculate a SHA-256 hash of the image for external verification."
                                   Opacity="0.6" FontSize="13" TextWrapping="Wrap" />
                        <ProgressBar Minimum="0" Maximum="100" Value="{Binding ProgressPercentage}"
                                     Visibility="{Binding IsHashProgressVisible, Converter={StaticResource BoolToVisibilityConverter}}" />
                        <Grid>
                            <Button Content="Compute SHA-256" Padding="20,8"
                                IsEnabled="{Binding CanVerify}"
                                Command="{Binding ComputeHashCommand}" />
                        </Grid>
                        <TextBox Header="Hash" IsReadOnly="True" Text="{Binding ComputedHash, Mode=OneWay}"
                                 PlaceholderText="Hash will appear here..."
                                 Visibility="{Binding IsHashOutputVisible, Converter={StaticResource BoolToVisibilityConverter}}" />
                    </StackPanel>
                </StackPanel>
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</Page>
